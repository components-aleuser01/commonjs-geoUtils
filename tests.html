<html>
<head>
  <title>commonjs-geoUtils In-Browser Tests</title>
  <link rel="stylesheet" type="text/css" href="http://moshen.github.com/commonjs-geoUtils/style.css" />
  <style type="text/css">
  
  pre.tests {
    margin: 3px;
    padding: 2px;
  }
  
  pre.tests-passed {
    background-color: green;
    color: white;
  }
  
  pre.tests-failed {
    background-color: red;
    color: white;
  }
  
  </style>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
  <script type="text/javascript" src="http://github.com/api/v2/json/blob/show/moshen/commonjs-geoUtils/6f4ddb501f4ea6011368ca85d1907243addbcad0"></script>
  <script>
  document.write = function(s){
    $('div#test-results').append(s);
  };
  
  $(document).ready(function(){
    $('input#runtests').bind('click', function(){
      var branch = $('select#runtestsoption option:selected').val();
    
      $.getJSON('http://github.com/api/v2/json/commits/list/moshen/commonjs-geoUtils/' + branch + '?callback=?',
      
        function(data){
          var latestCommit = data.commits[0].id;
        
        
          var runTests = function(){
            $.getJSON('http://github.com/api/v2/json/blob/show/moshen/commonjs-geoUtils/' +
                      latestCommit + '/tests/geoUtils.js' + '?callback=?',
          
              function(data){
                eval(data.blob.data); // I'm so, so sorry
                $('pre.tests').each(function(index){
                  if( $(this).text().indexOf('[PASSED]') == 0 ){
                    $(this).addClass('tests-passed');
                  } else if( $(this).text().indexOf('[FAILED]') == 0 ){
                    $(this).addClass('tests-failed');
                  }
                });
              });
          };
          
          var modulesToLoad = [{file : 'lib/number'  , name : 'lib/number'  },
                               {file : 'lib/geodesy' , name : 'lib/geodesy' },
                               {file : 'lib/latLon'  , name : 'lib/latLon'  },
                               {file : 'lib/bounding', name : 'lib/bounding'},
                               {file : 'lib/geoUtils', name : 'lib/geoUtils'},
                               {file : 'tests/assert', name : 'assert'      }];
          
          var loadModules = function(){
            var currentModule = modulesToLoad.pop();
          
            $.getJSON('http://github.com/api/v2/json/blob/show/moshen/commonjs-geoUtils/' +
                      latestCommit + '/' + 
                      currentModule.file + '.js' + '?callback=?',
          
              function(data){
                require.define(currentModule.name, function(require, module, exports){
                  eval(data.blob.data); // Again, I apologize.
                });
          
                if( modulesToLoad.length > 0 ){
                  loadModules();
                }else{
                  runTests();
                }
              });
          };
          
          loadModules();
          
      });
    });
  });
  </script>
</head>

<body>
  <div id="container">
    <h1>commonjs-geoUtils In-Browser Tests</h1>
    <p>To run the tests in your browser, please select a branch and press "Run Tests"</p>
        <select id="runtestsoption"><option value="master" >master</option><option value="develop" selected="selected">develop</option></select>
        <input type="button" id="runtests" value="Run Tests" />
    <br />
    <p>If you have a browser with a javascript console, all the required modules are loaded to use geoUtils once the tests are run.  To get started, try:</p>
    <pre>var gu = require('lib/geoUtils');</pre>
		<p>The print(); function will append to the tests div below</p>
    <div id="test-results"></div>
  </div>
</body>
</html>
