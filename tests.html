<html>
<head>
<title>commonjs-geoUtils In-Browser Tests</title>
<style type="text/css">
div#test-results {
  width: 60%;
}

pre.tests {
  margin: 3px;
  padding: 2px;
}

pre.tests-passed {
  background-color: green;
  color: white;
}

pre.tests-failed {
  background-color: red;
  color: white;
}

</style>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<script type="text/javascript" src="require.js"></script>
<script>
document.write = function(s){
  $('div#test-results').append(s);
};

$.getJSON('http://query.yahooapis.com/v1/public/yql?' +
    'q=select%20*%20from%20json%20where%20url%3D%22' +
    encodeURIComponent('http://github.com/api/v2/json/commits/list/moshen/commonjs-geoUtils/develop') +
    '%22&format=json&callback=?',

    function(data){
      var latestCommit = data.query.results.json.commits[0].id;
    

var runTests = function(){
  $.getJSON('http://query.yahooapis.com/v1/public/yql?' +
    'q=select%20*%20from%20json%20where%20url%3D%22' +
    encodeURIComponent('http://github.com/api/v2/json/blob/show/moshen/commonjs-geoUtils/' + latestCommit + '/tests/geoUtils.js') +
    '%22&format=json&callback=?',

    function(data){
      eval(data.query.results.blob.data); // I'm so, so sorry
      $('pre.tests').each(function(index){
        if( $(this).text().indexOf('[PASSED]') == 0 ){
          $(this).addClass('tests-passed');
        } else if( $(this).text().indexOf('[FAILED]') == 0 ){
          $(this).addClass('tests-failed');
        } else {
          console.log(this);
        }
      });
    });
};

var modulesToLoad = [{file : 'lib/number', name : 'lib/number'},
                     {file : 'lib/geodesy', name : 'lib/geodesy'},
                     {file : 'lib/latLon', name : 'lib/latLon'},
                     {file : 'lib/bounding', name : 'lib/bounding'},
                     {file : 'lib/geoUtils', name : 'lib/geoUtils'},
                     {file : 'tests/assert', name : 'assert'}];

var loadModules = function(){
  var currentModule = modulesToLoad.pop();

  $.getJSON('http://query.yahooapis.com/v1/public/yql?' +
    'q=select%20*%20from%20json%20where%20url%3D%22' +
    encodeURIComponent('http://github.com/api/v2/json/blob/show/moshen/commonjs-geoUtils/' + latestCommit+ '/' + 
    currentModule.file + '.js') +
    '%22&format=json&callback=?',

    function(data){
      require.define(currentModule.name, function(require, module, exports){
        eval(data.query.results.blob.data); // Again, I apologize.
      });

      if( modulesToLoad.length > 0 ){
        loadModules();
      }else{
        runTests();
      }
    });
};

loadModules();

});

</script>


</head>

<body>
<div id="test-results"></div>
</body>
</html>
